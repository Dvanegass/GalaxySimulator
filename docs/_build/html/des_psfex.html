

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DES PSFex &mdash; GalSim 2.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="DES Shapelet" href="des_shapelet.html" />
    <link rel="prev" title="DES Meds" href="des_meds.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> GalSim
          

          
          </a>

          
            
            
              <div class="version">
                2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">Images and Related Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="sb.html">Surface Brightness Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="wcs.html">World Coordinate Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="noise.html">Noise and Random Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="chromatic.html">Wavelength-dependent Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="shear.html">Weak Lensing Shear</a></li>
<li class="toctree-l1"><a class="reference internal" href="coord.html">Angles and Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Helper Functions and Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">The Config Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="hsm.html">The HSM Module</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="des.html">The DES Module</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="des_meds.html">DES Meds</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">DES PSFex</a></li>
<li class="toctree-l2"><a class="reference internal" href="des_shapelet.html">DES Shapelet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wfirst.html">The WFIRST Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Revision History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GalSim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="des.html">The DES Module</a> &raquo;</li>
        
      <li>DES PSFex</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/des_psfex.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="des-psfex">
<h1>DES PSFex<a class="headerlink" href="#des-psfex" title="Permalink to this headline">¶</a></h1>
<p>Part of the DES module.  This file implements one way that DES measures the PSF.</p>
<p>The <a class="reference internal" href="#galsim.des.DES_PSFEx" title="galsim.des.DES_PSFEx"><code class="xref any py py-class docutils literal notranslate"><span class="pre">DES_PSFEx</span></code></a> class handles interpolated PCA images, which are generally stored in <code class="docutils literal notranslate"><span class="pre">*_psfcat.psf</span></code> files.</p>
<p>See documentation here: <a class="reference external" href="https://www.astromatic.net/pubsvn/software/psfex/trunk/doc/psfex.pdf">https://www.astromatic.net/pubsvn/software/psfex/trunk/doc/psfex.pdf</a>.</p>
<dl class="class">
<dt id="galsim.des.DES_PSFEx">
<em class="property">class </em><code class="sig-prename descclassname">galsim.des.</code><code class="sig-name descname">DES_PSFEx</code><span class="sig-paren">(</span><em class="sig-param">file_name</em>, <em class="sig-param">image_file_name=None</em>, <em class="sig-param">wcs=None</em>, <em class="sig-param">dir=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/des/des_psfex.html#DES_PSFEx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.des.DES_PSFEx" title="Permalink to this definition">¶</a></dt>
<dd><p>Class that handles DES files describing interpolated principal component images
of the PSF.  These are usually stored as <code class="docutils literal notranslate"><span class="pre">*_psfcat.psf</span></code> files.</p>
<p>PSFEx is software written by Emmanuel Bertin.  If you want more detail about it, please
check out the web site:</p>
<blockquote>
<div><p><a class="reference external" href="http://www.astromatic.net/software/psfex">http://www.astromatic.net/software/psfex</a></p>
</div></blockquote>
<p>It builds PSF objects from images of stars in a given exposure, finds a reasonable basis
set to describe those images, and then fits the coefficient of these bases as a function
of the <code class="docutils literal notranslate"><span class="pre">(x,y)</span></code> position on the image.</p>
<p>Note that while the interpolation is done in image coordinates, GalSim usually deals with
object profiles in world coordinates.  However, PSFEx does not consider the WCS of the
image when building its bases.  The bases are built in image coordinates.  So there are
two options to get GalSim to handle this difference.</p>
<ol class="arabic">
<li><p>Ignore the WCS of the original image.  In this case, the *.psf files have all the
information you need:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">des_psfex</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">des</span><span class="o">.</span><span class="n">DES_PSFEx</span><span class="p">(</span><span class="n">fitpsf_file_name</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image_pos</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">PositionD</span><span class="p">(</span><span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span><span class="p">)</span>    <span class="c1"># position in pixels on the image</span>
<span class="gp">&gt;&gt;&gt; </span>                                                  <span class="c1"># NOT in arcsec on the sky!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">des_psfex</span><span class="o">.</span><span class="n">getPSF</span><span class="p">(</span><span class="n">image_pos</span><span class="p">)</span>      <span class="c1"># profile is in image coordinates</span>
</pre></div>
</div>
<p>The psf profile that is returned will be in image coordinates.  Therefore, it should be
drawn onto an image with no wcs.  (Or equivalently, one with <code class="docutils literal notranslate"><span class="pre">scale</span> <span class="pre">=</span> <span class="pre">1</span></code>.)  If you want
to use this to convolve a galaxy profile, you would want to either project the galaxy
(typically constructed in world coordinates) to the correct image coordinates or project
the PSF up into world coordinates.</p>
</li>
<li><p>Build the PSF in world coordinates directly.  The DES_PSFEx constructor can take an
extra argument, either <code class="docutils literal notranslate"><span class="pre">image_file_name</span></code> or <code class="docutils literal notranslate"><span class="pre">wcs</span></code>, to tell GalSim what WCS to use for
the coversion between image and world coordinates.  The former option is the name of
the file from which to read the WCS, which will often be more convenient, but you can
also just pass in a WCS object directly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">des_psfex</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">des</span><span class="o">.</span><span class="n">DES_PSFEx</span><span class="p">(</span><span class="n">fitpsf_file_name</span><span class="p">,</span> <span class="n">image_file_name</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image_pos</span> <span class="o">=</span> <span class="n">galsim</span><span class="o">.</span><span class="n">PositionD</span><span class="p">(</span><span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span><span class="p">)</span>    <span class="c1"># position in pixels on the image</span>
<span class="gp">&gt;&gt;&gt; </span>                                                  <span class="c1"># NOT in arcsec on the sky!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">des_psfex</span><span class="o">.</span><span class="n">getPSF</span><span class="p">(</span><span class="n">image_pos</span><span class="p">)</span>      <span class="c1"># profile is in world coordinates</span>
</pre></div>
</div>
<p>This time the psf profile that is returned will already be in world coordinates as
GalSim normally expects, so you can use it in the normal ways.  If you want to draw it
(or a convolved object) onto an image with the original WCS at that location, you can use
<code class="docutils literal notranslate"><span class="pre">des_psfex.getLocalWCS(image_pos)</span></code> for the local wcs at the location of the PSF.</p>
</li>
</ol>
<p>Note that the returned psf here already includes the pixel.  This is what is sometimes
called an “effective PSF”.  Thus, you should not convolve by the pixel profile again
(nor integrate over the pixel).  This would effectively include the pixel twice!</p>
<p>In GalSim, you should always pass <code class="docutils literal notranslate"><span class="pre">method='no_pixel'</span></code> when drawing images of objects
convolved with PSFs produced with this class.  Other drawing methods, such as photon shooting
(<code class="docutils literal notranslate"><span class="pre">method='phot'</span></code>) or an FFT (<code class="docutils literal notranslate"><span class="pre">method='fft'</span></code>), will result in convolving the pixel twice.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_name</strong> (<em>string</em>) – The file name to be read in, or a pyfits HDU in which case it is used
directly instead of being opened.</p></li>
<li><p><strong>image_file_name</strong> (<em>string</em>) – The name of the fits file of the original image (needed for the
WCS information in the header).  If unavailable, you may omit this
(or use None), but then the returned profiles will be in image
coordinates, not world coordinates.  (Default <code class="docutils literal notranslate"><span class="pre">image_file_name</span> <span class="pre">=</span> <span class="pre">None</span></code>)</p></li>
<li><p><strong>wcs</strong> (<em>object</em>) – Optional way to provide the WCS if you already have it loaded from the
image file. (Default <code class="docutils literal notranslate"><span class="pre">wcs</span> <span class="pre">=</span> <span class="pre">None</span></code>)</p></li>
<li><p><strong>dir</strong> (<em>string</em>) – Optionally a directory name can be provided if the file_name does not
already include it.  (The image file is assumed to be in the same
directory.) (Default <code class="docutils literal notranslate"><span class="pre">dir</span> <span class="pre">=</span> <span class="pre">None</span></code>).  Cannot pass an HDU with this option.</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="galsim.des.DES_PSFEx.getLocalWCS">
<code class="sig-name descname">getLocalWCS</code><span class="sig-paren">(</span><em class="sig-param">image_pos</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/des/des_psfex.html#DES_PSFEx.getLocalWCS"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.des.DES_PSFEx.getLocalWCS" title="Permalink to this definition">¶</a></dt>
<dd><p>If the original image was provided to the constructor, this will return the local
WCS at a given location in that original image.  If not, this will return None.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image_pos</strong> (<em>object</em>) – position in pixels in the image.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Local WCS.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.des.DES_PSFEx.getPSF">
<code class="sig-name descname">getPSF</code><span class="sig-paren">(</span><em class="sig-param">image_pos</em>, <em class="sig-param">gsparams=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/des/des_psfex.html#DES_PSFEx.getPSF"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.des.DES_PSFEx.getPSF" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the PSF at position <code class="docutils literal notranslate"><span class="pre">image_pos</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_pos</strong> (<em>object</em>) – The position in image coordinates at which to build the PSF.</p></li>
<li><p><strong>gsparams</strong> (<em>object</em>) – A <code class="docutils literal notranslate"><span class="pre">GSParams</span></code> instance to pass to the constructed GSObject. [Defualt is None].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the PSF as a <a class="reference internal" href="gsobject.html#galsim.GSObject" title="galsim.GSObject"><code class="xref any py py-class docutils literal notranslate"><span class="pre">GSObject</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="galsim.des.DES_PSFEx.getPSFArray">
<code class="sig-name descname">getPSFArray</code><span class="sig-paren">(</span><em class="sig-param">image_pos</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/galsim/des/des_psfex.html#DES_PSFEx.getPSFArray"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#galsim.des.DES_PSFEx.getPSFArray" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the PSF image as a numpy array at position image_pos in image coordinates.</p>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="des_shapelet.html" class="btn btn-neutral float-right" title="DES Shapelet" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="des_meds.html" class="btn btn-neutral float-left" title="DES Meds" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, GalSim-developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>